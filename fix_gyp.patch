From 6e0f3bd08130cb20d1726bd5e9306c5a1e8ab656 Mon Sep 17 00:00:00 2001
From: Vitaly Zaitsev <vitaly@easycoding.org>
Date: Thu, 15 Sep 2016 22:21:35 +0300
Subject: [PATCH] Fixed build under Fedora 24+.

---
 Telegram/gyp/Telegram.gyp        |  5 +++++
 Telegram/gyp/qt.gypi             | 31 +++++++++++++++++--------------
 Telegram/gyp/telegram_linux.gypi |  7 +++++++
 Telegram/gyp/utils.gyp           |  8 ++++++++
 4 files changed, 37 insertions(+), 14 deletions(-)

diff --git a/Telegram/gyp/Telegram.gyp b/Telegram/gyp/Telegram.gyp
index 0e8db70..38139b0 100644
--- a/Telegram/gyp/Telegram.gyp
+++ b/Telegram/gyp/Telegram.gyp
@@ -70,6 +70,11 @@
 
     'defines': [
       'AL_LIBTYPE_STATIC',
+      '__STDC_FORMAT_MACROS',
+      'TDESKTOP_DISABLE_AUTOUPDATE',
+      'TDESKTOP_DISABLE_REGISTER_CUSTOM_SCHEME',
+      'TDESKTOP_DISABLE_DESKTOP_FILE_GENERATION',
+      'TDESKTOP_DISABLE_CRASH_REPORTS',
     ],
 
     'include_dirs': [
diff --git a/Telegram/gyp/qt.gypi b/Telegram/gyp/qt.gypi
index b82f833..00f320a 100644
--- a/Telegram/gyp/qt.gypi
+++ b/Telegram/gyp/qt.gypi
@@ -69,7 +69,7 @@
             'qt_loc_unix': '/usr/local/Qt-<(qt_version)'
           }],
           [ 'build_mac and not build_macold', {
-            'qt_loc_unix': '/usr/local/tdesktop/Qt-<(qt_version)',
+            'qt_loc_unix': '/usr/local/Qt-<(qt_version)',
             'qt_libs': [
               '<@(qt_libs)',
               'Qt5Core',
@@ -78,7 +78,7 @@
             ],
           }],
           [ 'build_linux', {
-            'qt_loc_unix': '/usr/local/tdesktop/Qt-<(qt_version)',
+            'qt_loc_unix': '/usr/local/Qt-<(qt_version)',
             'qt_lib_prefix': 'lib',
             'qt_lib_debug_postfix': '.a',
             'qt_lib_release_postfix': '.a',
@@ -92,18 +92,6 @@
               'Qt5DBus',
               'Qt5Core',
               'qtpcre',
-              'ssl',
-              'crypto',
-              'Xi',
-              'Xext',
-              'SM',
-              'ICE',
-              'fontconfig',
-              'expat',
-              'freetype',
-              'xcb-shm',
-              'xcb-xfixes',
-              'xcb-render',
               'xcb-static',
             ],
           }],
@@ -204,7 +192,13 @@
       'libraries': [
         '/usr/local/lib/libxkbcommon.a',
         '<@(qt_libs_release)',
+        'icuuc',
+        'icutu',
+        'icui18n',
         'xcb',
+        'xcb-shm',
+        'xcb-xfixes',
+        'xcb-render',
         'X11',
         'X11-xcb',
         'dbus-1',
@@ -212,6 +206,15 @@
         'gthread-2.0',
         'glib-2.0',
         'pthread',
+        'ssl',
+        'crypto',
+        'Xi',
+        'Xext',
+        'SM',
+        'ICE',
+        'fontconfig',
+        'expat',
+        'freetype',
       ],
       'include_dirs': [
         '<(qt_loc)/mkspecs/linux-g++',
diff --git a/Telegram/gyp/telegram_linux.gypi b/Telegram/gyp/telegram_linux.gypi
index 15bfbb6..60c849c 100644
--- a/Telegram/gyp/telegram_linux.gypi
+++ b/Telegram/gyp/telegram_linux.gypi
@@ -30,12 +30,16 @@
     },
     'include_dirs': [
       '/usr/local/include',
+      '/usr/local/ssl/include',
       '<(libs_loc)/openssl-xcode/include'
+      '/usr/include',
     ],
     'library_dirs': [
       '/usr/local/lib',
+      '/usr/local/ssl/lib',
       '<(libs_loc)/libexif-0.6.20/libexif/.libs',
       '<(libs_loc)/breakpad/src/client/linux',
+      '/usr/lib',
     ],
     'libraries': [
       'breakpad_client',
@@ -54,6 +58,9 @@
       'libva-drm.a',
       'libva.a',
       'libz.a',
+      'webp',
+      'fontconfig',
+      'freetype',
 #      '<!(pkg-config 2> /dev/null --libs <@(pkgconfig_libs))',
     ],
     'cflags_cc': [
diff --git a/Telegram/gyp/utils.gyp b/Telegram/gyp/utils.gyp
index 117c87a..160a4c3 100644
--- a/Telegram/gyp/utils.gyp
+++ b/Telegram/gyp/utils.gyp
@@ -123,10 +123,14 @@
           }, {
             'include_dirs': [
               '/usr/local/include',
+              '/usr/local/ssl/include',
               '<(libs_loc)/openssl-xcode/include'
+              '/usr/include',
             ],
             'library_dirs': [
               '/usr/local/lib',
+              '/usr/local/ssl/lib',
+              '/usr/lib',
             ],
           }]
         ],
@@ -145,10 +149,14 @@
           }, {
             'include_dirs': [
               '/usr/local/include',
+              '/usr/local/ssl/include',
               '<(libs_loc)/openssl-xcode/include'
+              '/usr/include',
             ],
             'library_dirs': [
               '/usr/local/lib',
+              '/usr/local/ssl/lib',
+              '/usr/lib',
             ],
           }]
         ],
-- 
2.7.4

