From 3ccc6e873bbd25ab7f979ee4fafb9e5f6791526a Mon Sep 17 00:00:00 2001
From: Vitaly Zaitsev <vitaly@easycoding.org>
Date: Mon, 13 Mar 2017 12:50:27 +0100
Subject: [PATCH] Use correct build flags for Fedora.

---
 Telegram/gyp/settings_linux.gypi | 11 +++++++++++
 Telegram/gyp/telegram_linux.gypi | 29 ++++++++++++++++++++++++++---
 2 files changed, 37 insertions(+), 3 deletions(-)

diff --git a/Telegram/gyp/settings_linux.gypi b/Telegram/gyp/settings_linux.gypi
index 4cdf7a5..fb702aa 100644
--- a/Telegram/gyp/settings_linux.gypi
+++ b/Telegram/gyp/settings_linux.gypi
@@ -22,11 +22,18 @@
     [ 'build_linux', {
       'variables': {
         'linux_common_flags': [
+          '-O2',
+          '-flto',
           '-pipe',
           '-g',
           '-Wall',
           '-W',
           '-fPIC',
+          '-Werror=format-security',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-Wno-unused-result',
           '-Wno-unused-variable',
           '-Wno-unused-parameter',
@@ -36,6 +43,7 @@
           '-Wno-unused-but-set-variable',
           '-Wno-missing-field-initializers',
           '-Wno-sign-compare',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
       },
       'conditions': [
@@ -72,6 +80,9 @@
         '<@(linux_common_flags)',
         '-std=gnu++14',
       ],
+      'ldflags': [
+        '-specs=/usr/lib/rpm/redhat/redhat-hardened-ld',
+      ],
       'configurations': {
         'Debug': {
         },
diff --git a/Telegram/gyp/telegram_linux.gypi b/Telegram/gyp/telegram_linux.gypi
index 64a5906..5807570 100644
--- a/Telegram/gyp/telegram_linux.gypi
+++ b/Telegram/gyp/telegram_linux.gypi
@@ -83,18 +83,41 @@
     'configurations': {
       'Release': {
         'cflags': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-pipe',
+          '-g',
+          '-Wall',
+          '-W',
+          '-fPIC',
+          '-Werror=format-security',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-fno-strict-aliasing',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
         'cflags_cc': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-pipe',
+          '-g',
+          '-Wall',
+          '-W',
+          '-fPIC',
+          '-Werror=format-security',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-fno-strict-aliasing',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
         'ldflags': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-ld',
         ],
       },
     },
-- 
2.9.3

