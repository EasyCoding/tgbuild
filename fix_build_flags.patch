From b1b5ae41f9f5b954c469b56f6306e4f5a115cee7 Mon Sep 17 00:00:00 2001
From: Vitaly Zaitsev <vitaly@easycoding.org>
Date: Thu, 30 Mar 2017 20:16:32 +0200
Subject: [PATCH 4/4] Use correct build flags for Fedora.

---
 Telegram/gyp/settings_linux.gypi | 11 +++++++++++
 Telegram/gyp/telegram_linux.gypi | 31 ++++++++++++++++++++++++++++---
 2 files changed, 39 insertions(+), 3 deletions(-)

diff --git a/Telegram/gyp/settings_linux.gypi b/Telegram/gyp/settings_linux.gypi
index fde88dc..bb3e710 100644
--- a/Telegram/gyp/settings_linux.gypi
+++ b/Telegram/gyp/settings_linux.gypi
@@ -22,12 +22,19 @@
     [ 'build_linux', {
       'variables': {
         'linux_common_flags': [
+          '-O2',
+          '-flto',
           '-pipe',
           '-g',
           '-Wall',
           '-Werror',
           '-W',
           '-fPIC',
+          '-Werror=format-security',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-Wno-unused-variable',
           '-Wno-unused-parameter',
           '-Wno-unused-function',
@@ -36,6 +43,7 @@
           '-Wno-unused-but-set-variable',
           '-Wno-missing-field-initializers',
           '-Wno-sign-compare',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
       },
       'conditions': [
@@ -72,6 +80,9 @@
         '<@(linux_common_flags)',
         '-std=gnu++14',
       ],
+      'ldflags': [
+        '-specs=/usr/lib/rpm/redhat/redhat-hardened-ld',
+      ],
       'configurations': {
         'Debug': {
         },
diff --git a/Telegram/gyp/telegram_linux.gypi b/Telegram/gyp/telegram_linux.gypi
index 64a5906..e8450f9 100644
--- a/Telegram/gyp/telegram_linux.gypi
+++ b/Telegram/gyp/telegram_linux.gypi
@@ -83,18 +83,43 @@
     'configurations': {
       'Release': {
         'cflags': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-pipe',
+          '-g',
+          '-Wall',
+          '-W',
+          '-fPIC',
+          '-Werror=format-security',
+          '-Wimplicit-fallthrough=0',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-fno-strict-aliasing',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
         'cflags_cc': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-pipe',
+          '-g',
+          '-Wall',
+          '-W',
+          '-fPIC',
+          '-Werror=format-security',
+          '-Wimplicit-fallthrough=0',
+          '-D_FORTIFY_SOURCE=2',
+          '-fexceptions',
+          '-fstack-protector-strong --param=ssp-buffer-size=4',
+          '-grecord-gcc-switches',
           '-fno-strict-aliasing',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1',
         ],
         'ldflags': [
-          '-Ofast',
+          '-O2',
           '-flto',
+          '-specs=/usr/lib/rpm/redhat/redhat-hardened-ld',
         ],
       },
     },
-- 
2.9.3

