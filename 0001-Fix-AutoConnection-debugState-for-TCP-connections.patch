From f0ab72ffbc8ff46b3be09297ef6b98384d44d135 Mon Sep 17 00:00:00 2001
From: John Preston <johnprestonmail@gmail.com>
Date: Thu, 30 Mar 2017 18:20:51 +0300
Subject: [PATCH] Fix AutoConnection::debugState() for TCP connections. Fix
 #3171

Also silent new Xcode version warning.
---
 Telegram/SourceFiles/mtproto/connection_auto.cpp | 2 +-
 Telegram/gyp/refresh.sh                          | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/Telegram/SourceFiles/mtproto/connection_auto.cpp b/Telegram/SourceFiles/mtproto/connection_auto.cpp
index 15ca89c..886cfd9 100644
--- a/Telegram/SourceFiles/mtproto/connection_auto.cpp
+++ b/Telegram/SourceFiles/mtproto/connection_auto.cpp
@@ -307,7 +307,7 @@ bool AutoConnection::needHttpWait() {
 }
 
 int32 AutoConnection::debugState() const {
-	return (status == UsingHttp) ? -1 : (UsingTcp ? sock.state() : -777);
+	return (status == UsingHttp) ? -1 : ((status == UsingTcp) ? sock.state() : -777);
 }
 
 QString AutoConnection::transport() const {
diff --git a/Telegram/gyp/refresh.sh b/Telegram/gyp/refresh.sh
index 9ee05ae..87f16da 100755
--- a/Telegram/gyp/refresh.sh
+++ b/Telegram/gyp/refresh.sh
@@ -20,7 +20,7 @@ else
   #gyp --depth=. --generator-output=../.. -Goutput_dir=out Telegram.gyp --format=xcode-ninja
   #gyp --depth=. --generator-output=../.. -Goutput_dir=out Telegram.gyp --format=xcode
   # use patched gyp with Xcode project generator
-  ../../../Libraries/gyp/gyp --depth=. --generator-output=../.. -Goutput_dir=out Telegram.gyp -Gxcode_upgrade_check_project_version=820 --format=xcode
+  ../../../Libraries/gyp/gyp --depth=. --generator-output=../.. -Goutput_dir=out Telegram.gyp -Gxcode_upgrade_check_project_version=830 --format=xcode
 fi
 
 cd ../..
-- 
2.9.3

